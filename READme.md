# phASE-Stitcher

**Stitcher** for the readbackphased haplotype blocks in F1 hybrids.\
***A python program to segregate and stitch the ReadBackPhased genotypes in F1 hybrids using first order markov chain and transition probabilities.\
This tool can be used as a companion tool with [`phase-Extender`](https://github.com/everestial/phase-Extender) or as a standalone tool.***

Developed by [Bishwa K. Giri](mailto:kirannbishwa01@gmail.com) in the [Remington Lab](https://biology.uncg.edu/people/david-remington/) at the University of North Carolina at Greensboro, Biology department.

## Citation
Giri, B. K., Remington D. L. Haplotype phase extension and preparation of diploid genome using phase-Extender and phase-Stitcher. biorxiv (2018) [not uploaded yet].

## AUTHOR/SUPPORT
Bishwa K. Giri (bkgiri@uncg.edu; kirannbishwa01@gmail.com) \
Support @ https://groups.google.com/d/forum/phase-extender

## Intro to ReadBackPhasing
**Check these links for details on readbackphasing**
- https://software.broadinstitute.org/gatk/documentation/tooldocs/3.8-0/org_broadinstitute_gatk_tools_walkers_phasing_ReadBackedPhasing.php
- https://github.com/secastel/phaser/tree/master/phaser

<br>
<br>

# BACKGROUND
Haplotype phasing is a second "go to" problem in bioinformatics after read alignment. The importance of haplotype phasing applies directly to the analyses of ASE (allele specific expression), preparation of extended haplotype for EHH (extended haplotype homozygosity) test, and preparation of dipolid genome which will soon be a new standard in bioinformatics in coming years, etc. The necessity for haplotype phasing (and eventually diploid genome) increases with the increase in heterozygosity in the genome, because higher hetetogeneity leads to larger alignment bias and complicates the reliability of the variants that are called using that alignment data (SAM, BAM files).

Haplotype phasing has mostly concerntrated around fixing the phase state in less heterogenous individuals and/or in inbred lines. Existing methods in haplotype phasing have not addressed issues with genome that are highly heterogenous or are hybrids. The only possible method to phase F1 hybrids is by taking `mom, dad, child` trio, which is not optimal when parental information are missing, or in wild populations of hybrids.

**`phase-Stitcher`** is designed to overcome this limitations in haplotype phasing by utilizing
  - With increase in the size of sequence reads we are able to generate larger RBphased fragments. These fragments are again considerably larger when a heterogenous population is sequenced. F1 hyrbids of these heterogenous population have even larger RBphased fragments. Thus, haplotype phasing using RBphase data is most optimal approach to solving haplotype phasing.
  - This tool doesn't require exact `maternal, parental` data to solve phase state in F1. Rather phasing can be casually approached by supplying genotype data from `maternal vs. parental` background. 
  - this tools is also able to segregate haplotype into maternal vs. paternal background, thus solving haplotype phase state genome wide. 
  - 
  
  
# to be Contd ..... 





This program is designed to extend the haplotypes using the phased genotypes (allele) states of paritally phased F1 hybrids. It exclusively uses the `Phased Genotype i.e PG` and `Phase Block Index i.e PI` generated by the program `pHASER` https://github.com/secastel/phaser , https://github.com/secastel/phaser/tree/master/phaser

Assumption: This program underlies the following assumptions
- ASE analyses in hybrid individuals/population are more susceptible to biased ASE observation considering following factors:
    - alignment to reference genome will likely trigger higher mapping of the reads from the population closer to the reference genome.
    - allele masking to solve the above problems is again more likely to attract paralogous alignment creating futher biases.
    - Cautionary approaches to ASE anlayses in hybrids involve preparation of diploid genome and then alignment using competitive and conserved strategy
    - Competitive and conserved alignment requires preparation of diploid genome.
    - Preparation of the diploid genome using allele frequency alone is susceptible to switch-errors.
    
 
This tools address the above limitations and provides a method to create a less biased whole genome haplotype by taking in following consideration:

- F1 hybrids contains higher number of heterozygous sites there by providing a pool of genetic variaion which can be used with NGS data to create paritially phased (readback phased) haplotypes.
- Maternal and paternal populations are diverged enough that allele frequency in maternal vs. paternal population can be used to indentify which haplotype in F1 came from which population.
- The identified haplotypes can then be stitched to create a genomewide haplotypes for the given F1 hybrid.
- phasing in F1 hybrids need not consider the effects from the recombination since recombination happened in the paternal and maternal population.
- phase state in the F1 can be directly identified by taking into the consideration 
    - allele frequecy of the phased allele in the maternal vs. paternal population
    - running a 0 order markov model which directly utilizes the given frequency of allele in each population
    - or by running a 1st order markov model if there are partially (readback phased) population resequence data
    

## Note:
- Basically this tool takes the paritally phased haplotypes
    - segregates them to maternal vs. paternal population haplotypes (using markov model)
    - stitches the haplotypes to create a genome wide haplotype
    
This program is exclusively designed to phase haplotypes in F1 hybrid for now and should work equally with data generated from genome reseq, RNAseq, WES or RAD given the individual is a hybrid derived from divergent strains and/or populations, but may be used to equally extended to phase F2 hybrids (work on progress).

# Prerequisites:
Python packages and modules
- Python3 (https://www.python.org/)
- pandas (http://pandas.pydata.org/)
- io
- pyvcf (https://github.com/jamescasbon/PyVCF)
- itertools
- collections
- functools

# Running phase-Stitcher

## Usage (**using the given test data in the example folder**): 

    python Stitcher_using_1stOrderMarkov_InteractiveMode.py --vcf1 MY_subSample.vcf --vcf2 SP_subSample.vcf --pop1 My --pop2 Sp --output test --het_vcf F1_subSample.vcf --f1_sample 2ms04h


